# Claude-Flow Orchestration Configuration
# DOL Remediation Project

name: dol-remediation
version: "1.0.0"
description: |
    Multi-agent orchestration for transforming DOL from prototype
    to production-ready DSL toolchain.

# Repository to work on
repository:
    url: https://github.com/univrs/dol
    branch: main

# Working directory structure
workspace:
    root: ./univrs-dol
    outputs: ./outputs
    logs: ./logs

# Agent definitions with specializations
agents:
    orchestrator:
        description: "Coordinates all agents, manages dependencies, handles releases"
        model: claude-sonnet-4-20250514
        system_prompt: |
            You are the orchestrator agent for the Metal DOL remediation project.
            Your responsibilities:
            - Coordinate work between specialist agents
            - Track task completion and dependencies
            - Manage phase gates and success criteria
            - Handle project structure and configuration

            Current project state: Phase 1 - Foundation
            Reference: docs/roadmap.md for full plan
            Reference: CLAUDE.md for project context
        tools:
            - file_operations
            - git_operations
            - task_management

    lexer-agent:
        description: "Lexer implementation, tokenization, error handling"
        model: claude-sonnet-4-20250514
        system_prompt: |
            You are the lexer specialist for Metal DOL.
            Your expertise: Rust, tokenization, lexical analysis, logos crate.

            Key files you own:
            - src/lexer.rs
            - src/error.rs (LexError)
            - tests/lexer_tests.rs

            Standards:
            - All public items must have /// doc comments
            - All token types must have tests
            - Use Span for source location tracking
            - Handle edge cases (unterminated strings, invalid chars)
        tools:
            - file_operations
            - rust_compiler
            - test_runner

    parser-agent:
        description: "Parser, AST, validation implementation"
        model: claude-sonnet-4-20250514
        system_prompt: |
            You are the parser specialist for Metal DOL.
            Your expertise: Rust, recursive descent parsing, AST design.

            Key files you own:
            - src/parser.rs
            - src/ast.rs
            - src/validator.rs
            - tests/parser_tests.rs

            Standards:
            - Recursive descent parser (no generator)
            - Comprehensive error messages with spans
            - Validate exegesis is mandatory
            - Support all declaration types: gene, trait, constraint, system, evolves
        tools:
            - file_operations
            - rust_compiler
            - test_runner

    cli-agent:
        description: "CLI tools: dol-parse, dol-test, dol-check"
        model: claude-sonnet-4-20250514
        system_prompt: |
            You are the CLI tooling specialist for Metal DOL.
            Your expertise: Rust, clap, CLI design, code generation.

            Key files you own:
            - src/bin/dol-parse.rs
            - src/bin/dol-test.rs
            - src/bin/dol-check.rs
            - src/codegen.rs
            - src/test_parser.rs

            CLI Requirements:
            - Use clap for argument parsing
            - Support JSON output for tooling integration
            - Exit codes for CI integration (0=success, 1=error)
            - Colored output for terminal
        tools:
            - file_operations
            - rust_compiler
            - test_runner

    docs-agent:
        description: "Documentation, examples, tutorials, grammar"
        model: claude-sonnet-4-20250514
        system_prompt: |
            You are the documentation specialist for Metal DOL.
            Your expertise: Technical writing, examples, tutorials.

            Key files you own:
            - docs/grammar.ebnf
            - docs/specification.md
            - docs/tutorials/*.md
            - examples/**/*.dol
            - README.md

            Standards:
            - All examples must parse successfully
            - Tutorials build progressively
            - Cross-reference with EBNF grammar
            - Include working code examples
        tools:
            - file_operations
            - markdown_lint

    ci-agent:
        description: "CI/CD, GitHub Actions, release automation"
        model: claude-sonnet-4-20250514
        system_prompt: |
            You are the CI/CD specialist for Metal DOL.
            Your expertise: GitHub Actions, release automation, testing.

            Key files you own:
            - .github/workflows/ci.yml
            - .github/workflows/release.yml
            - .github/ISSUE_TEMPLATE/*.md
            - CHANGELOG.md

            CI Requirements:
            - All tests must pass
            - cargo fmt --check
            - cargo clippy -- -D warnings
            - cargo doc must build
            - DOL file validation
        tools:
            - file_operations
            - github_actions

# Execution phases with gates
phases:
    phase_1_foundation:
        name: "Foundation"
        description: "Tests, documentation, project structure"
        agents: [orchestrator, lexer-agent, parser-agent, docs-agent]
        tasks:
            - task_1_1_project_structure
            - task_1_2_cargo_toml
            - task_1_3_error_types
            - task_1_4_lexer_docs_tests
            - task_1_5_ast_docs
            - task_1_6_parser_docs_tests
            - task_1_7_ebnf_grammar
        gate:
            criteria:
                - "cargo test passes"
                - "cargo clippy clean"
                - "20+ lexer tests"
                - "20+ parser tests"

    phase_2_tooling:
        name: "Tooling"
        description: "CLI implementations"
        depends_on: [phase_1_foundation]
        agents: [cli-agent, parser-agent]
        tasks:
            - task_2_1_dol_parse
            - task_2_2_validator
            - task_2_3_dol_test
            - task_2_4_dol_check
            - task_2_5_cli_tests
        gate:
            criteria:
                - "dol-parse functional"
                - "dol-test generates compiling tests"
                - "dol-check validates files"

    phase_3_documentation:
        name: "Documentation"
        description: "Tutorials, examples, README"
        depends_on: [phase_2_tooling]
        agents: [docs-agent]
        tasks:
            - task_3_1_examples
            - task_3_2_tutorial_gene
            - task_3_3_tutorial_traits
            - task_3_4_tutorial_constraints
            - task_3_5_tutorial_evolution
            - task_3_6_specification
            - task_3_7_readme
        gate:
            criteria:
                - "12+ example DOL files"
                - "4 tutorials complete"
                - "All examples parse"

    phase_4_community:
        name: "Community"
        description: "CI/CD, release, community files"
        depends_on: [phase_3_documentation]
        agents: [ci-agent, orchestrator]
        tasks:
            - task_4_1_ci
            - task_4_2_release_workflow
            - task_4_3_changelog
            - task_4_4_contributing
            - task_4_5_issue_templates
            - task_4_6_first_release
        gate:
            criteria:
                - "CI pipeline green"
                - "v0.0.1 released"

# Initial bootstrap commands
bootstrap:
    - command: "git clone https://github.com/univrs/metadol.git metadol || true"
    - command: "cd metadol && git checkout -b remediation/phase-1 || true"
    - command: "mkdir -p src/bin tests examples/{genes,traits,constraints,systems} docs/tutorials .github/workflows"
    - command: "cp ../CLAUDE.md ."
    - command: "cp ../docs/roadmap.md docs/"
    - command: "cp ../.claude-flow/tasks.yaml .claude-flow/"

# Success metrics
metrics:
    test_coverage: ">80%"
    doc_coverage: "100%"
    clippy_warnings: 0
    example_files: ">12"
    tutorials: 4
